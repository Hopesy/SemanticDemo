# Semantic Kernel å¤æ‚æ¡ˆä¾‹é›†

æœ¬é¡¹ç›®åŒ…å«çœŸå®çš„ã€ä¼ä¸šçº§çš„ Semantic Kernel å¤æ‚åº”ç”¨æ¡ˆä¾‹,è€Œä¸æ˜¯ç®€å•çš„æ¦‚å¿µæ¼”ç¤ºã€‚

## ğŸŒŸ çœŸå®å¤æ‚æ¡ˆä¾‹

### 1. **çœŸå®çš„ RAG ç³»ç»Ÿ** (`Concepts/RAG`)

**æŠ€æœ¯æ ˆ**:
- âœ… **çœŸå®çš„å‘é‡æ•°æ®åº“**: Qdrant (æœ¬åœ° Docker)
- âœ… **çœŸå®çš„å‘é‡åµŒå…¥**: OpenAI text-embedding-ada-002
- âœ… **çœŸå®çš„è¯­ä¹‰æœç´¢**: ä½™å¼¦ç›¸ä¼¼åº¦æ£€ç´¢
- âœ… **å¤šè½®å¯¹è¯è®°å¿†**: ChatHistory ä¸Šä¸‹æ–‡ç®¡ç†

**åŠŸèƒ½ç‰¹ç‚¹**:
1. **æ„å»ºçŸ¥è¯†åº“**: çœŸå®ç”Ÿæˆå‘é‡å¹¶å­˜å‚¨åˆ° Qdrant
2. **è¯­ä¹‰æœç´¢**: å‘é‡æ£€ç´¢è¿”å›ç›¸ä¼¼åº¦åˆ†æ•°
3. **RAG é—®ç­”**: æ£€ç´¢å¢å¼ºç”Ÿæˆå®Œæ•´æµç¨‹
4. **å¤šè½®å¯¹è¯**: å¸¦ä¸Šä¸‹æ–‡è®°å¿†çš„æ™ºèƒ½é—®ç­”

**å¦‚ä½•è¿è¡Œ**:
```bash
# 1. å¯åŠ¨ Qdrant å‘é‡æ•°æ®åº“
docker run -p 6333:6333 qdrant/qdrant

# 2. è¿è¡Œé¡¹ç›®
cd Concepts/RAG
dotnet run
```

**æ ¸å¿ƒä»£ç **:
```csharp
// çœŸå®çš„å‘é‡ç”Ÿæˆå’Œå­˜å‚¨
var embedding = await embeddingService.GenerateEmbeddingAsync(text);
var point = new PointStruct
{
    Id = new PointId { Num = id++ },
    Vectors = embedding.ToArray(),
    Payload = { ["text"] = text, ["category"] = category }
};
await client.UpsertAsync(CollectionName, points);

// çœŸå®çš„å‘é‡æœç´¢
var searchResults = await client.SearchAsync(
    collectionName: CollectionName,
    vector: queryEmbedding.ToArray(),
    limit: 3
);
```

---

### 2. **æ™ºèƒ½å®¢æœç³»ç»Ÿ - å¤šä»£ç†åä½œ** (`Concepts/Agents`)

**æŠ€æœ¯æ ˆ**:
- âœ… **Agent Handoff**: æ™ºèƒ½è·¯ç”±å’Œåˆ‡æ¢
- âœ… **å¤šä¸“ä¸šåŒ– Agent**: åˆ†æµã€è®¢å•ã€æŠ€æœ¯ã€å”®å
- âœ… **çœŸå®çš„åç«¯ API**: è®¢å•æŸ¥è¯¢æ’ä»¶æ¨¡æ‹Ÿæ•°æ®åº“
- âœ… **ä¸Šä¸‹æ–‡è®°å¿†**: è·¨ Agent çš„å¯¹è¯å†å²

**Agent å›¢é˜Ÿ**:
1. **åˆ†æµ Agent**: è¯†åˆ«é—®é¢˜ç±»å‹,æ™ºèƒ½è·¯ç”±
2. **è®¢å•çŠ¶æ€ Agent**: æŸ¥è¯¢è®¢å•ã€ç‰©æµä¿¡æ¯
3. **æŠ€æœ¯æ”¯æŒ Agent**: å¤„ç†äº§å“æŠ€æœ¯é—®é¢˜
4. **é€€æ¢è´§ Agent**: å¤„ç†å”®åæœåŠ¡

**å¦‚ä½•è¿è¡Œ**:
```bash
cd Concepts/Agents
dotnet run
```

**æ ¸å¿ƒä»£ç **:
```csharp
// å¤š Agent åˆ›å»º
var triageAgent = CreateTriageAgent(kernel);
var orderAgent = CreateOrderAgent(kernel);
var technicalAgent = CreateTechnicalAgent(kernel);

// æ™ºèƒ½è·¯ç”±
var routingResult = await RouteQuestion(triageAgent, question);
var targetAgent = agents[routingResult.AgentType];

// Agent åˆ‡æ¢
if (currentAgent == null || routingResult.AgentType != GetAgentKey(currentAgent))
{
    currentAgent = agents[routingResult.AgentType];
    Console.WriteLine($"åˆ‡æ¢åˆ°: {currentAgent.Name}");
}
```

**çœŸå®çš„è®¢å•æŸ¥è¯¢æ’ä»¶**:
```csharp
[KernelFunction, Description("æŸ¥è¯¢è®¢å•çŠ¶æ€å’Œç‰©æµä¿¡æ¯")]
public string QueryOrder([Description("è®¢å•å·")] string orderId)
{
    // ä»æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢çœŸå®è®¢å•æ•°æ®
    if (OrderDatabase.TryGetValue(orderId, out var order))
    {
        return $"è®¢å•ä¿¡æ¯:\n- è®¢å•å·: {order.OrderId}\n...";
    }
}
```

---

### 3. **ç”µå•†è®¢å•å¤„ç†å·¥ä½œæµ** (`Concepts/OrderProcessWorkflow`)

**æŠ€æœ¯æ ˆ**:
- âœ… **å·¥ä½œæµç¼–æ’**: äº‹ä»¶é©±åŠ¨ã€çŠ¶æ€ç®¡ç†ã€æ­¥éª¤ç¼–æ’
- âœ… **AI é£é™©è¯„ä¼°**: æ™ºèƒ½è®¢å•é£é™©è¯„åˆ†
- âœ… **å¹¶è¡Œå¤„ç†**: æ‰‡å‡º/æ‰‡å…¥æ¨¡å¼
- âœ… **é”™è¯¯å¤„ç†**: è‡ªåŠ¨é‡è¯•æœºåˆ¶

**å·¥ä½œæµæ­¥éª¤**:
```
åˆ›å»ºè®¢å• â†’ åº“å­˜æ£€æŸ¥ â†’ [AI é£é™©è¯„ä¼°] â†’ æ”¯ä»˜å¤„ç†
    â†’ [å¹¶è¡Œ: å‘è´§å‡†å¤‡ + å‘ç¥¨ç”Ÿæˆ + é€šçŸ¥å‘é€] â†’ å‘è´§ â†’ å®Œæˆ
```

**æ ¸å¿ƒç‰¹æ€§**:
1. **çº¿æ€§æµç¨‹**: ç®€å•çš„è®¢å•å¤„ç†æµ
2. **æ¡ä»¶åˆ†æ”¯**: åŸºäº AI é£é™©è¯„åˆ†çš„äººå·¥å®¡æ ¸
3. **å¹¶è¡Œå¤„ç†**: å¤šä»»åŠ¡åŒæ—¶æ‰§è¡Œ(æ‰‡å‡º/æ‰‡å…¥)
4. **é”™è¯¯é‡è¯•**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„æ”¯ä»˜æ“ä½œ

**å¦‚ä½•è¿è¡Œ**:
```bash
cd Concepts/OrderProcessWorkflow
dotnet run
```

**æ ¸å¿ƒä»£ç **:
```csharp
// AI é£é™©è¯„ä¼°
var riskScore = await workflow.AssessRiskWithAI(kernel, order);
if (riskScore > 70)
{
    await workflow.RequestManualReview(order);
}

// å¹¶è¡Œå¤„ç†(æ‰‡å‡º)
var tasks = new List<Task>
{
    PrepareShipment(),
    GenerateInvoice(),
    SendNotification()
};
await Task.WhenAll(tasks); // æ‰‡å…¥

// è‡ªåŠ¨é‡è¯•
int retryCount = 0;
while (!success && retryCount < maxRetries)
{
    try { await ProcessPayment(); }
    catch { /* é‡è¯•é€»è¾‘ */ }
}
```

**å­¦åˆ°çš„ Process Framework æ ¸å¿ƒæ¦‚å¿µ**:
- âœ… **çŠ¶æ€ç®¡ç†**: Order çŠ¶æ€è´¯ç©¿æ•´ä¸ªæµç¨‹
- âœ… **äº‹ä»¶é©±åŠ¨**: æ¯ä¸ªæ­¥éª¤å®Œæˆåè§¦å‘ä¸‹ä¸€æ­¥
- âœ… **æ¡ä»¶åˆ†æ”¯**: æ ¹æ® AI è¯„åˆ†é€‰æ‹©ä¸åŒè·¯å¾„
- âœ… **å¹¶è¡Œæ‰§è¡Œ**: å¤šä¸ªæ­¥éª¤åŒæ—¶è¿›è¡Œ
- âœ… **é”™è¯¯æ¢å¤**: æ”¯ä»˜å¤±è´¥è‡ªåŠ¨é‡è¯•

---

## ğŸ“Š å¤æ‚åº¦å¯¹æ¯”

| æ¡ˆä¾‹ | ç®€å•ç‰ˆæœ¬ | å¤æ‚ç‰ˆæœ¬ (æœ¬é¡¹ç›®) |
|------|----------|----------------|
| **RAG** | æ¨¡æ‹Ÿæ•°æ®,æ— çœŸå®å‘é‡ | âœ… Qdrant çœŸå®å‘é‡æ•°æ®åº“,å®Œæ•´ RAG æµç¨‹ |
| **Agents** | å• Agent,æ¨¡æ‹Ÿæ’ä»¶ | âœ… 4ä¸ªä¸“ä¸š Agent,æ™ºèƒ½åˆ‡æ¢,çœŸå®è®¢å• API |
| **OrderWorkflow** | ç®€å•çº¿æ€§æµç¨‹ | âœ… AI é£é™©è¯„ä¼°,å¹¶è¡Œå¤„ç†,è‡ªåŠ¨é‡è¯• |
| **Memory** | æ¦‚å¿µæ¼”ç¤º | âœ… (ä¿ç•™åŸæ ·,RAG å·²è¦†ç›–) |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶
1. .NET 8.0 SDK
2. Docker (ç”¨äº Qdrant)
3. OpenAI API Key (æˆ–å…¼å®¹ API,å¦‚ DeepSeek)

### é…ç½®
ç¼–è¾‘ `Common/appsettings.json`:
```json
{
  "type": "openai",
  "model": "deepseek-chat",
  "endpoint": "https://api.deepseek.com/v1",
  "apikey": "your-api-key"
}
```

### è¿è¡Œæ¡ˆä¾‹

```bash
# 1. RAG ç³»ç»Ÿ (éœ€è¦ Qdrant)
docker run -p 6333:6333 qdrant/qdrant
cd Concepts/RAG
dotnet run

# 2. å¤šä»£ç†å®¢æœç³»ç»Ÿ
cd Concepts/Agents
dotnet run

# 3. è®¢å•å¤„ç†å·¥ä½œæµ
cd Concepts/OrderProcessWorkflow
dotnet run

# 4. å…¶ä»–åŸºç¡€æ¡ˆä¾‹
cd Concepts/ChatCompletion  # æˆ–å…¶ä»–é¡¹ç›®
dotnet run
```

---

## ğŸ“š å­¦ä¹ è·¯å¾„

### åˆå­¦è€… (Starts ç›®å½•)
1. `GettingStarted` - åŸºç¡€å…¥é—¨
2. `BasicKernelLoading` - Kernel åˆ›å»º
3. `FunctionCalling` - å‡½æ•°è°ƒç”¨

### è¿›é˜¶ (Concepts ç›®å½•)
1. `ChatCompletion` - å¯¹è¯è¡¥å…¨
2. `Plugins` - æ’ä»¶ç³»ç»Ÿ
3. `PromptTemplates` - æç¤ºè¯æ¨¡æ¿
4. `Filtering` - è¿‡æ»¤å™¨å’Œä¸­é—´ä»¶
5. `DependencyInjection` - ä¾èµ–æ³¨å…¥

### é«˜çº§ (çœŸå®å¤æ‚æ¡ˆä¾‹)
1. **`RAG`** - çœŸå®çš„å‘é‡æ•°æ®åº“ + æ£€ç´¢å¢å¼ºç”Ÿæˆ
2. **`Agents`** - å¤šä»£ç†åä½œ + æ™ºèƒ½è·¯ç”±
3. **`OrderProcessWorkflow`** - å·¥ä½œæµç¼–æ’ + AI å†³ç­– + å¹¶è¡Œå¤„ç†

---

## ğŸ¯ å…³é”®çŸ¥è¯†ç‚¹

### 1. RAG ç³»ç»Ÿçš„å®Œæ•´æµç¨‹
- âœ… æ–‡æœ¬å‘é‡åŒ– (Embedding)
- âœ… å‘é‡æ•°æ®åº“å­˜å‚¨ (Qdrant)
- âœ… è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢
- âœ… ä¸Šä¸‹æ–‡å¢å¼ºçš„ AI ç”Ÿæˆ
- âœ… å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†

### 2. Agent Handoff (å¤šä»£ç†åä½œ)
- âœ… ä¸“ä¸šåŒ– Agent è®¾è®¡
- âœ… æ™ºèƒ½è·¯ç”±ç®—æ³•
- âœ… Agent ä¹‹é—´çš„åˆ‡æ¢æœºåˆ¶
- âœ… ä¸Šä¸‹æ–‡åœ¨ Agent é—´ä¼ é€’
- âœ… çœŸå®çš„å¤–éƒ¨ API é›†æˆ

### 3. å·¥ä½œæµç¼–æ’ (Process-like Framework)
- âœ… äº‹ä»¶é©±åŠ¨æ¶æ„
- âœ… çŠ¶æ€ç®¡ç†å’ŒæŒä¹…åŒ–
- âœ… æ¡ä»¶åˆ†æ”¯å’Œå¹¶è¡Œå¤„ç†
- âœ… é”™è¯¯å¤„ç†å’Œè‡ªåŠ¨é‡è¯•
- âœ… AI æ™ºèƒ½å†³ç­–é›†æˆ

### 4. ä¼ä¸šçº§æœ€ä½³å®è·µ
- âœ… é…ç½®é©±åŠ¨ (appsettings.json)
- âœ… ä¾èµ–æ³¨å…¥ (DI)
- âœ… æ’ä»¶åŒ–æ¶æ„
- âœ… é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥
- âœ… æ—¥å¿—å’Œå¯è§‚æµ‹æ€§

---

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### RAG é¡¹ç›®
```csharp
// çœŸå®çš„å‘é‡å­˜å‚¨
await client.UpsertAsync(CollectionName, points);

// çœŸå®çš„è¯­ä¹‰æœç´¢
var results = await client.SearchAsync(
    collectionName: CollectionName,
    vector: queryEmbedding.ToArray(),
    limit: 3
);

// æ£€ç´¢å¢å¼ºç”Ÿæˆ
var context = string.Join("\n", relevantTexts);
history.AddUserMessage($"äº§å“çŸ¥è¯†:\n{context}\n\nç”¨æˆ·é—®é¢˜: {question}");
var answer = await chatService.GetChatMessageContentAsync(history);
```

### Agents é¡¹ç›®
```csharp
// å¤š Agent å›¢é˜Ÿ
var agents = new Dictionary<string, ChatCompletionAgent>
{
    ["triage"] = triageAgent,
    ["order"] = orderAgent,
    ["technical"] = technicalAgent,
    ["return"] = returnAgent
};

// æ™ºèƒ½è·¯ç”±
var routingResult = await RouteQuestion(triageAgent, question);
var targetAgent = agents[routingResult.AgentType];

// çœŸå®çš„å‡½æ•°è°ƒç”¨
[KernelFunction, Description("æŸ¥è¯¢è®¢å•çŠ¶æ€")]
public string QueryOrder(string orderId)
{
    return OrderDatabase.TryGetValue(orderId, out var order)
        ? FormatOrderInfo(order)
        : "æœªæ‰¾åˆ°è®¢å•";
}
```

---

## ğŸ“– å‚è€ƒèµ„æ–™

- [Semantic Kernel å®˜æ–¹æ–‡æ¡£](https://learn.microsoft.com/semantic-kernel)
- [Qdrant å‘é‡æ•°æ®åº“](https://qdrant.tech/)
- [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings)
- [Agent è®¾è®¡æ¨¡å¼](https://learn.microsoft.com/semantic-kernel/agents)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

## ğŸ“„ è®¸å¯è¯

MIT License
